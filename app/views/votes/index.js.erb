// ==UserScript==
// @name         Highlight Fanhao
// @namespace    https://www.libredmm.com
// @version      <%= Time.now.strftime('%y%m%d.%H%M%S') %>
// @description  Highlight matched AV codes (aka Fanhao)
// @author       LibreDMM
// @match        http*://tp.m-team.cc/adult.php*
// @match        http*://www.hd1080.org/forum.php*
// @match        http*://www.sehuatang.org/forum*
// @match        http*://localhost*
// ==/UserScript==

(function() {
    'use strict';
    document.querySelectorAll('a').forEach(function(a){
        var m = a.text.match(/<%= oneregex(
            Movie.voted_by(@user).pluck(:code) +
            Movie.bookmarked_by(@user).pluck(:code) +
            Movie.with_baidu_pan_resources.pluck(:code)
        )%>/i);
        if (m) {
            var cls = []
            if (m[0].match(/<%= oneregex(Movie.upvoted_by(@user).pluck(:code)) %>/i)) {
                cls.push('upvote')
            } else if (m[0].match(/<%= oneregex(Movie.downvoted_by(@user).pluck(:code)) %>/i)) {
                cls.push('downvote')
            } else if (m[0].match(/<%= oneregex(Movie.bookmarked_by(@user).pluck(:code)) %>/i)) {
                cls.push('bookmark')
            }
            if (m[0].match(/<%= oneregex(Movie.with_baidu_pan_resources.pluck(:code)) %>/i)) {
                cls.push('baidu_pan')
            }
            var mark = `<mark class="${cls.join(' ')}">${m[0]}</mark>`;
            a.innerHTML = a.innerHTML.replace(m[0], mark);
        }
    });
})();